#!/bin/bash

DIR="$(dirname "$0")"
PARENT=$(dirname "$DIR")

if [[ $1 == "tokenize" ]]; then
    python3 "$DIR/_tokenize.py" ${@:2}
elif [[ $1 == "predict" ]]; then
    if [[ $# -ne 2 ]]; then
        echo "Usage: rn-coverage predict CONFIG"
        exit 1
    fi
    TMP=$(mktemp)
    envsubst < $PARENT/config/inference.yaml > $TMP
    PYTHONPATH="$PARENT" python3 -m src predict --config $TMP --config $2
elif [[ $1 == "train" ]]; then
    if [[ $# -ne 2 ]]; then
        echo "Usage: rn-coverage train CONFIG"
        exit 1
    fi
    TMP=$(mktemp)
    envsubst < $PARENT/config/training.yaml > $TMP
    PYTHONPATH="$PARENT" python3 -m src fit --config $TMP --config $2
elif [[ $1 == "finetune" ]]; then
    if [[ $# -ne 2 ]]; then
        echo "Usage: rn-coverage finetune CONFIG"
        exit 1
    fi
    TMP=$(mktemp)
    envsubst < $PARENT/config/finetuning.yaml > $TMP
    PYTHONPATH="$PARENT" python3 -m src fit --config $TMP --config $2
else
    echo "Usage: rn-coverage tokenize|train|finetune|predict"
    exit 1
fi
